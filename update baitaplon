#include<iostream>
#include<string>
#include<cmath>

using namespace std;

class Profile{
	private:
		string  fullname, mssv, province, Class;
		float gpa;
	public:
		friend istream& operator >> (istream& is, Profile &pf1);
		friend ostream& operator << (ostream& os, Profile &pf1);
		float getgpa();
		string getName();
};

istream& operator >> (istream& is, Profile &pf1){ ///ham nhap 
	cout<<"Enter of the name: ";
	fflush(stdin);
	getline(is, pf1.fullname);
	cout<<endl;
	cout<<"Enter of the mssv: ";
	fflush(stdin);
	getline(is, pf1.mssv);
	cout<<endl;
	cout<<"Enter of the class: ";
	fflush(stdin);
	getline(is, pf1.Class);
	cout<<endl;
	cout<<"Enter of the province: ";
	fflush(stdin);
	getline(is, pf1.province);
	cout<<endl;
	cout<<"Enter of the gpa: ";
	is>>pf1.gpa;
	cout<<endl;
	return is;
}
ostream& operator << (ostream& os, Profile &pf1){   //ham xuat 
	os<<"Fullname: "<<pf1.fullname<<endl;
	os<<"Mssv: "<<pf1.mssv<<endl;
	os<<"Class: "<<pf1.Class<<endl;
	os<<"Provice: "<<pf1.province<<endl;
	os<<"GPA: "<<pf1.gpa<<endl;
	return os;
}
float Profile::getgpa(){ // chi xuat  
	return this->gpa;
}
string Profile::getName(){  //chi xuat 
	return this->fullname;
}

class Practise:public Profile {
	private:
		int lesson, allow, n_allow;
		float practise;
		int s_lesson;
	public:
		friend istream& operator >> (istream& is , Practise &pt1);
		friend ostream& operator << (ostream& os, Practise &pt1);
		float point();
		void setPractise(float x);
		float getPractise();
		int getallow();
		int getn_allow(); 		 
};
int Practise::getallow(){
	return this->allow; 
} 
int Practise::getn_allow(){
	return this->n_allow; 
} 

istream& operator >> (istream& is, Practise &pt1){ 
	cout<<"Enter of the sum lesson: ";
	is>>pt1.s_lesson;
	cout<<endl;
	cout<<"Enter of the lesson: ";
	is>>pt1.lesson;
	cout<<endl;
	cout<<"Enter of the allow: ";
	is>>pt1.allow;
	cout<<endl;
	cout<<"Enter of the not allow: ";
	is>>pt1.n_allow;
	cout<<endl;
	return is;
}
ostream& operator << (ostream& os, Practise &pt1){    
	os<<"Sum lesson: "<<pt1.s_lesson<<endl;
	os<<"Lesson: "<<pt1.lesson<<endl;
	os<<"Allow: "<<pt1.allow<<endl;
	os<<"Not allow: "<<pt1.n_allow<<endl;
	os<<"Point practise: "<<pt1.getPractise()<<endl;
	return os;
}
float Practise::point(){
	int cur;   
	int pre;
	float temp;
	cur= allow + n_allow;
	if(cur > (float)(s_lesson * 0.15)){
		temp=0;
	}
	else{
		pre=lesson*5 + allow*3 + n_allow*2;
		temp=(float)(pre*1.0/s_lesson);
	}
	return temp;
} 
void Practise::setPractise(float x){
	this->practise=x;
}
float Practise::getPractise(){
         setPractise(point());
	return this->practise;
}
class Scholarship : public Practise{
	private:
		string namebank;
		int numberbank;
	public:
		friend istream& operator >> (istream& is, Scholarship &ip1);
		friend ostream& operator << (ostream& os, Scholarship &ip1);
		bool check();
		string getnamebank();
		int getnumberbank();	
};
string Scholarship::getnamebank(){
	 return this->namebank; 
} 
int Scholarship::getnumberbank(){
	return this->numberbank; 
} 
istream& operator >> (istream& is, Scholarship &ip1){
	if(ip1.check()){
		cout<<"Confirm Scholarship !!"<<endl;
		cout<<"Enter of the name bank: ";
		fflush(stdin);
		getline(is, ip1.namebank);
		cout<<endl;
		cout<<"Enter of the number bank: ";
		is>>ip1.numberbank;
		cout<<endl;
		return is;
	}
	cout<<"Don't Scholarship !!"<<endl;
	ip1.namebank="0";
	ip1.numberbank=0;
}
ostream& operator << (ostream& os, Scholarship &ip1){
		os<<"Name bank: "<<ip1.namebank<<endl;
		os<<"Number bank: "<<ip1.numberbank<<endl;
		return os;
}
bool Scholarship::check(){
	if(getGpa() >= 7.5 && getPractise() >= 4)
		return true;
	else 
		return false;	
}

class Student: public Scholarship{
	public:
		friend istream& operator >> (istream& is, Student &st1);
		friend ostream& operator << (ostream& os, Student &st1);
		
};

istream& operator >> (istream& is, Student &st1){
	Profile *pf1=static_cast<Profile *>(&st1);
	is>>*pf1;
	Practise *pr1=static_cast<Practise *>(&st1);
	is>>*pr1;
	Scholarship *sp1=static_cast<Scholarship *>(&st1);
	is>>*sp1;
	return is;
}
ostream& operator << (ostream& os, Student &st1){
	os<<"~~~~~~~~~~~~~~~"<<endl;
	Profile *pf1=static_cast<Profile *>(&st1);
	os<<*pf1;
	Practise *pr1=static_cast<Practise *>(&st1);
	os<<*pr1;
	Scholarship *sp1=static_cast<Scholarship *>(&st1);
	os<<*sp1;
	return os;
}

struct Node{
	Student data;//chua du lieu cau nut(du lieu student) 
	Node *next; //lien ket cac nut voi nhau 
};

class Student_Management{
	private:
		long size;//chieu dai cua danh sach lien ket 
		Node *head;//tao nut dau danh sach 
		Node *tail;// tao nut cuoi danh sach 
	public:
		Node* createNode(Student st);// Hàm tao 1  cái node 
		void addLast(Student st);
		Node* previous(Node *p);
		void removeFirst();
		void removeLast();
		void remove(Node *p);
		void traverse();
		void list_student(int &n);
		void Delete();
		void edit (Node *p);
			
};
Node* Student_Management::createNode(Student st){
	Node *p= new Node;// cap phat vung nho cho Node p 
	p->data=st; // truyen gia tri st cho data 
	p->next=NULL;// lúc moi tao th́ node do chua lien ket voi node nào het nen no tro den NULL 
	return p;//tra ve node p vua khoi tao 
}
void Student_Management::addLast(Student st){  // them node vao cuoi danh sach lien ket 
	Node *temp=createNode(st);
	if(head==NULL){    //dahh sach dang rong 
		head=tail=temp; //thi head=teil=temp (node dau cung là node cuoi la tepm lun) 
	}
	else{  // danh sach khong rong 
		tail->next=temp; //tail->next =temp (thay node can them vao cuoi danh sach) 
		tail=temp; // cap nhat lai node cuoi la temp 
	}
	size++; // cap nhat lai kich thuot danh sach 
}
Node* Student_Management::previous(Node *p) { //them vao dau danh sach 
	Node *t = head;
	while (t->next != p)
		t = t->next;
	return t;
}
void Student_Management::removeFirst(){//xoa dau 
	if(size==0) 
		return;
	Node* temp=head;
	head=head->next;
	delete temp;
	size --;	
}
void Student_Management::removeLast(){//xoa 
	if(size==0)
		return;
	if(size==1){
		delete head;
		size--;
		return;
	}
	Node *p=previous(tail);
	Node *temp=tail;
	p->next=NULL;
	tail=p;
	delete temp;
	size--;
		
}
void Student_Management::remove(Node *p) {
	if (p == head) {
		removeFirst();
		return;
	}
	if (p == tail) {
		removeLast();
		return;
	}
	Node *pre = previous(p);
	pre->next = p->next;
	delete p;
	size--;
}
void Student_Management::traverse(){ //xoa dah sach liên ket 
	Node *p=head;
	
	cout<<"=====List Information Student======"<<endl;
	while(p!=NULL){
		cout<<p->data;
		p=p->next;
	}
	delete p;
}
void Student_Management::list_student(int &n){//them student bat ḱ 
	Student value;
	do{
		cout<<"Enter the number of the students: ";
		cin>>n;
		cout<<endl;
	}while(n==0);
	
	for(int i=0;i<n;i++){
		cout<<"Student "<<i+1<<": "<<endl;
		cin>>value;
		addLast(value);
	}
}
void Student_Management::Delete(){
	string str;
	cout<<"Enter the you want to delete: ";
	fflush(stdin);
	getline(cin, str);
	cout<<endl;
	Node *p=head;
	while(p!=NULL){
		if(p->data.getName() == str){
			remove(p);
		}
	}
	delete p;
}
void Student_Management::edit (Node *p)
{
    int chose;
    while(true)
    {
        cout<<"1. edit namebank"<<endl;
        cout<<"2. edit numberbank"<<endl;
        cout<<"3. edit Gpa"<<endl;
        cout<<"4. edit Allow"<<endl;
        cout<<"5. edit NotAllow"<<endl;
        
        cin>>chose;

        if(chose==4)
            break;

        switch (chose)
        {
        case 1:
            {
                string namebank;
                cout<<"new namebank :";
                fflush(stdin);
                getline(cin,namebank);
                p->data.getnamebank() = namebank;
                break;
            }
            
            case 2:
            {
                int numberbank;
                cout<<"new numberbank :";
                cin>>numberbank; 
                p->data.getnumberbank() =numberbank;
                break;
            }
            
        case 3:
            {
                float Gpa;
                cout<<"new Gpa :";
                cin>>Gpa;
                p->data.getgpa() = gpa;
                break;
            }
            
             case 4:
            {
                int Allow;
                cout<<"new Allow :";
                cin>>Allow;
                p->data.getallow() = allow;
                break;
            }
            
             case 5:
            {
                int n_allow;
                cout<<"new NotAllow :";
                cin>>n_allow;
                p->data.getn_allow() = n_allow;
                break;
            }
        default:
            {
                cout<<"1->2->3->4->5"<<endl;
                break;
            }
        }

    }

}
int main(){
	Student_Management list;
	int n;
	list.list_student(n);
	cout<<"=========LIST STUDENT=========="<<endl;
	list.traverse();
	cout<<"-------------SAU KHI XOA------------"<<endl;

	list.Delete();
	list.traverse();
	list.edit(Node *p); 
	return 0;
}
